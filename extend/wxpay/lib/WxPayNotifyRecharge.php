<?phpini_set('date.timezone', 'Asia/Shanghai');error_reporting(E_ERROR);require_once "WxPay.Api.php";require_once 'WxPay.Notify.php';use app\common\model\User;use app\common\model\UserRecharge;class WxPayNotifyRecharge extends WxPayNotify{    //查询订单    public function Queryorder($transaction_id)    {        $input = new WxPayOrderQuery();        $input->SetTransaction_id($transaction_id);        $result = WxPayApi::orderQuery($input);        if (array_key_exists("return_code", $result)            && array_key_exists("result_code", $result)            && $result["return_code"] == "SUCCESS"            && $result["result_code"] == "SUCCESS") {            // todo            $time = time();            $UserRecharge = new UserRecharge();            $UserRechargeInfo = $UserRecharge->where([                'user_recharge_id' => $result['attach'],                'is_pay' => 1,            ])->limit(1)->find();            if (!$UserRechargeInfo) {                return false;            }            $UserRechargeInfo->is_pay = 2;            $UserRechargeInfo->pay_time = $time;            $UserRechargeRes = $UserRechargeInfo->save();            if ($UserRechargeRes) {                User::where(['user_id' => $UserRechargeInfo['user_id']])->setInc('user_lines', $UserRechargeInfo['lines']);            }            return true;        }        return false;    }    //重写回调处理函数    public function NotifyProcess($data, &$msg)    {        $notfiyOutput = array();        if (!array_key_exists("transaction_id", $data)) {            $msg = "输入参数不正确";            return false;        }        //查询订单，判断订单真实性        if (!$this->Queryorder($data["transaction_id"])) {            $msg = "订单查询失败";            return false;        }        return true;    }}