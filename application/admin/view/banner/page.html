<script>
    layui.use('form', function () {
        var form = layui.form //获取form模块
        form.on('select(page)', function (data) {
            // console.log(data.value);
            var index = data.value;
            var id=$('#banner_id').val();
            window.location.href="/admin/banner/page?index="+index+'&id='+id;
        });
    });
</script>
<div class="layui-body layui-tab-content site-demo site-demo-body">
    <div class="layui-tab-item layui-show">
        <div class="layui-main">
            <div id="LAY_preview">
                <input type="hidden" class="ext">
                <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
                    <legend>页面设置
                    </legend>
                </fieldset>
                <form class="layui-form" action="">
                    <div class="layui-form-item">
                        <label class="layui-form-label">页面</label>
                        <div class="layui-input-block">
                            <select name="page" lay-filter="page">
                                <option value=""></option>
                                {foreach $page as $key=>$value}
                                <option value="{$key}" {if condition="(!empty($ext)||$ext==0)&&$ext==$key"} selected{/if}>{$value['desc']}</option>
                                {/foreach}
                            </select>
                        </div>
                    </div>
                    <div id="ext">
                        {php}
                        if(!empty($ext)){
                        foreach($page[$ext]['ext'] as $key=>$value){
                        {/php}
                        <div class="layui-form-item">
                            <label class="layui-form-label">参数-{$value}：</label>
                            <div class="layui-input-block">
                                <input type="text" name="ext" lay-verify="required" placeholder="请输入{$value}"
                                       autocomplete="off" class="layui-input ext-info" value="{$extInfo[$key]}">
                            </div>
                        </div>
                        {php}}}{/php}
                    </div>
                    <!--<div class="layui-form-item layui-form-text">
                        <label class="layui-form-label">参数</label>
                        <div class="layui-input-block">
                            <textarea placeholder="请输入内容" class="layui-textarea"></textarea>
                        </div>
                    </div>
                    <div class="layui-form-item layui-form-text">
                      <label class="layui-form-label">编辑器</label>
                      <div class="layui-input-block">
                        <textarea class="layui-textarea layui-hide" name="content" lay-verify="content" id="LAY_demo_editor"></textarea>
                      </div>
                    </div>-->
                    <div class="layui-form-item">
                        <div class="layui-input-block">
                            <input type="hidden" name="banner_id" id="banner_id" value="{$banner_id}">
                            <button class="layui-btn" lay-filter="add" lay-submit="" id="submit">
                                立即提交
                            </button>
                            <!--<button type="reset" class="layui-btn layui-btn-primary">重置</button>-->
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    layui.use(['form', 'layer','upload'], function () {
        $ = layui.jquery;
        var form = layui.form
            , layer = layui.layer
        //监听提交
        form.on('submit(add)', function (data) {
            var details=[];
            $(".ext-info").each(function(){
                details.push($(this).val());
            });
            console.log(data.field,details)
            // return null;
            $.post("{:url('page')}", {data: data.field,details:details}, function (data) {
                var jsonData = JSON.parse(data);
                console.log(jsonData)
                if (jsonData[0] == 200) {
                    layer.alert(jsonData[1], {icon: 6}, function () {
                        // 获得frame索引
                        var index = parent.layer.getFrameIndex(window.name);
                        //关闭当前frame
                        parent.layer.close(index);
                    });
                } else {
                    layer.msg(jsonData[1], {time: 1000, icon: 5}, function () {

                    });
                }
                return false;
            });
            return false;

        });
        $('#cover').click(function () {
            layer.photos({
                photos: '#layer-photos-demo'
                ,anim: 5 //0-6的选择，指定弹出图片动画类型，默认随机（请注意，3.0之前的版本用shift参数）
            });
        });

    });
</script>